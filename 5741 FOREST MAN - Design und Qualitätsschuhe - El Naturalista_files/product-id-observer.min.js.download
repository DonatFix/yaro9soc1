define(['module','jquery','underscore','mageUtils','Interactiv4_StorefrontHtmlData/js/html-data-applier','jsComponentUtils'],function(module,$,_,utils,htmlDataApplier,jsComponentUtils){'use strict';return jsComponentUtils.resolveReturn({initialize:function(config){_.extend(this,config);this.productItemSelector=this.product_item_roles.map(productItemRole=>`${this.wrapRoleForSelector(productItemRole)}:not(${this.wrapDataForSelector(this.data_attribute_product_id)})`).join(', ');const tryApplyProductIdFromSelector=_.throttle(()=>$(this.productItemSelector).get().forEach(node=>this.tryApplyProductId(node)),this.apply_product_id_from_selector_max_execution_frequency);const tryApplyProductIdFromNode=node=>{if($(node).is(this.productItemSelector)){this.tryApplyProductId(node);}
window.requestIdleCallback(tryApplyProductIdFromSelector);};htmlDataApplier.awaitReady().then(tryApplyProductIdFromSelector).then(()=>htmlDataApplier.onNodeUpdate(tryApplyProductIdFromNode));},tryApplyProductId:function(node){let productIdNode=node.querySelector(this.wrapDataForSelector(this.data_attribute_product_id)),productId;if(productIdNode){productId=$(productIdNode).attr(`data-${this.data_attribute_product_id}`);}
if(_.isUndefined(productId)){node.querySelectorAll(this.wrapDataForSelector('post')).forEach(dataPostNode=>{let dataPost=$(dataPostNode).data('post');if(_.isObject(dataPost)){productId=utils.nested(dataPost,'data.product');}});}
if(!_.isUndefined(productId)){$(node).attr(`data-${this.data_attribute_product_id}`,productId);}},wrapRoleForSelector:function(role){return this.wrapDataForSelector('role',role);},wrapDataForSelector:function(dataAttribute,dataValue){return`[data-${dataAttribute}${_.isUndefined(dataValue) ? '' : `='${dataValue}'`}]`;}},module.config());});