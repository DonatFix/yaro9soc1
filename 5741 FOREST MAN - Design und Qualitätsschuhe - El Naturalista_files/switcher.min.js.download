define(['jquery','underscore','mage/cookies'],function($,_){'use strict';$.widget('lifeConcept.storeviewSwitcher',{_create:function(){this.fieldDestination=this.element.find('[name="destination"]');this.fieldLanguage=this.element.find('[name="language"]');this.button=this.element.find('button');this.bindEvents();this.fillOptions(this.fieldDestination,this.options.destinations);this.setInitialValues();},fillOptions:function(element,options,placeholder){element.empty();if(placeholder){element.append($('<option/>').val('').text(placeholder));}
_.each(options,function(option){if(option.disabled==true){element.append($('<option/>').val(option.value).text(option.label).prop("disabled",true));}else{element.append($('<option/>').val(option.value).text(option.label));}}.bind(this));element.change();},bindEvents:function(){var self=this;this.element.on('submit',function(){var destination=self.fieldDestination.val();var res=destination.split("_");$.cookie(self.options.cookieName,res[1],{path:'/'});var language=self.fieldLanguage.val();var redirectUrl=self.options.redirectUrls[language];if(redirectUrl){window.location.href=redirectUrl;}
return false;});this.fieldDestination.on('change',function(){var destination=$(this).val();self.fillOptions(self.fieldLanguage,self.options.languages[destination]);});this.fieldLanguage.on('change',function(){if($(this).val()){self.button.prop('disabled',false);}else{self.button.prop('disabled',true);}});},findCountryOption:function(country){let self=this;this.fieldDestination.find("option").each(function(){let web_country=this.value.split("_");if(web_country[1]==country){$('.store-switcher__current #country').html(this.text);self.options.currentDestination=this.value;}});},setInitialValues:function(){let currentCountry=$.cookie(this.options.cookieName);if(typeof currentCountry!="undefined"&&this.options.allow_countries.includes(currentCountry)){this.findCountryOption(currentCountry);}else{this.findCountryOption(this.options.allow_countries[0]);}
this.fieldDestination.val(this.options.currentDestination);this.fieldDestination.change();this.fieldLanguage.val(this.options.currentLanguage);this.fieldLanguage.change();}});return $.lifeConcept.storeviewSwitcher;});