define(['jquery','mage/storage','Magento_Ui/js/model/messageList','Magento_Customer/js/customer-data','mage/translate','i4EnhancedeStepCheckout'],function($,storage,globalMessageList,customerData,$t,i4EnhancedeStepCheckout){'use strict';var callbacks=[],action=function(loginData,redirectUrl,isGlobal,messageContainer){messageContainer=messageContainer||globalMessageList;return storage.post('customer/ajax/login',JSON.stringify(loginData),isGlobal).done(function(response){if(response.errors){messageContainer.addErrorMessage(response);callbacks.forEach(function(callback){callback(loginData,response);});}else{callbacks.forEach(function(callback){callback(loginData,response);});customerData.invalidate(['customer']);if(redirectUrl){window.location.href=redirectUrl;}else if(response.redirectUrl){window.location.href=response.redirectUrl;}else{i4EnhancedeStepCheckout.sendCheckoutOptionsStep(1,'login');location.reload();}}}).fail(function(){messageContainer.addErrorMessage({'message':$t('Could not authenticate. Please try again later')});callbacks.forEach(function(callback){callback(loginData);});});};action.registerLoginCallback=function(callback){callbacks.push(callback);};return action;});